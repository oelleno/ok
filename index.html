<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이미지 보기</title>
  <style>
    /* 중앙 정렬을 위한 스타일 */
    .container {
      position: relative;
      display: inline-block;
    }

    #image {
      display: block;
      max-width: 100%;
      height: auto;
    }

    #nameInput,
    #addressInput {
      position: absolute;
      left: 0;
      /* 왼쪽 정렬 */
      font-size: 20px;
      padding: 5px;
      background-color: rgba(255, 255, 255, 0.7);
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    #nameInput {
      top: 40%;
      /* 이름 입력 필드 위치 조정 */
    }

    #addressInput {
      top: 60%;
      /* 주소 입력 필드 위치 조정 */
    }

    #signatureCanvas {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 200px;
      height: 100px;
      border: 1px solid black;
      background-color: rgba(255, 255, 255, 0.7);
    }

    .checkbox-container {
      position: absolute;
      top: 20%;
      /* 이미지 위에 위치 조정 */
      left: 10%;
      /* 이미지 위에 위치 조정 */
      z-index: 10;
      /* 이미지 위에 표시되도록 설정 */
    }
  </style>
</head>

<body>
  <div class="container">
    <img id="image" src="join.jpeg" alt="Join Image">
    <input type="text" id="nameInput" placeholder="이름을 입력하세요">
    <input type="text" id="addressInput" placeholder="주소를 입력하세요">
    <canvas id="signatureCanvas"></canvas>
    <div class="checkbox-container">
      <label><input type="checkbox" id="checkbox1"> 체크박스 1</label><br>
      <label><input type="checkbox" id="checkbox2"> 체크박스 2</label><br>
      <label><input type="checkbox" id="checkbox3"> 체크박스 3</label>
    </div>
  </div>
  <br>
  <button id="saveBtn">확인 및 저장</button>

  <script>
    const signatureCanvas = document.getElementById('signatureCanvas');
    const signatureCtx = signatureCanvas.getContext('2d');
    let drawing = false;

    // 캔버스 크기 설정
    signatureCanvas.width = 200; // 서명 캔버스 너비
    signatureCanvas.height = 100; // 서명 캔버스 높이

    // 마우스 이벤트 리스너 추가
    signatureCanvas.addEventListener('mousedown', (e) => {
      drawing = true;
      signatureCtx.beginPath();
      signatureCtx.moveTo(e.offsetX, e.offsetY);
    });

    signatureCanvas.addEventListener('mousemove', (e) => {
      if (drawing) {
        signatureCtx.lineTo(e.offsetX, e.offsetY);
        signatureCtx.stroke();
      }
    });

    signatureCanvas.addEventListener('mouseup', () => {
      drawing = false;
      signatureCtx.closePath();
    });

    signatureCanvas.addEventListener('mouseout', () => {
      drawing = false;
      signatureCtx.closePath();
    });

    // 서명 스타일 설정
    signatureCtx.strokeStyle = 'black'; // 선 색상
    signatureCtx.lineWidth = 2; // 선 두께
    signatureCtx.lineCap = 'round'; // 선 끝 모양

    document.getElementById('saveBtn').addEventListener('click', function () {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = document.getElementById('image');
      const nameInput = document.getElementById('nameInput').value;
      const addressInput = document.getElementById('addressInput').value;

      // 캔버스 크기를 이미지의 자연 크기와 동일하게 설정
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;

      // 캔버스에 이미지 그리기
      ctx.drawImage(img, 0, 0);

      // 텍스트 스타일 설정
      ctx.font = '30px Arial'; // 글꼴 및 크기 설정
      ctx.fillStyle = 'blue'; // 텍스트 색상 설정
      ctx.textAlign = 'left'; // 텍스트 정렬 설정

      // 이름 입력 필드의 위치를 가져오기
      const nameField = document.getElementById('nameInput');
      const nameRect = nameField.getBoundingClientRect();
      const nameX = nameRect.left - img.getBoundingClientRect().left;
      const nameY = nameRect.top - img.getBoundingClientRect().top + (nameField.offsetHeight / 2);

      // 주소 입력 필드의 위치를 가져오기
      const addressField = document.getElementById('addressInput');
      const addressRect = addressField.getBoundingClientRect();
      const addressX = addressRect.left - img.getBoundingClientRect().left;
      const addressY = addressRect.top - img.getBoundingClientRect().top + (addressField.offsetHeight / 2);

      // 텍스트를 입력 필드의 위치에 그리기
      ctx.fillText(nameInput, nameX, nameY);
      ctx.fillText(addressInput, addressX, addressY + 40); // 주소는 이름 아래에 그리기

      // 체크박스 상태 가져오기
      const checkbox1 = document.getElementById('checkbox1').checked ? '☑ 체크박스 1' : '☐ 체크박스 1';
      const checkbox2 = document.getElementById('checkbox2').checked ? '☑ 체크박스 2' : '☐ 체크박스 2';
      const checkbox3 = document.getElementById('checkbox3').checked ? '☑ 체크박스 3' : '☐ 체크박스 3';

      // 체크박스 상태를 캔버스에 그리기
      ctx.font = '20px Arial'; // 체크박스 텍스트 크기 설정
      ctx.fillStyle = 'black'; // 체크박스 텍스트 색상 설정
      ctx.fillText(checkbox1, 10, img.naturalHeight - 60);
      ctx.fillText(checkbox2, 10, img.naturalHeight - 40);
      ctx.fillText(checkbox3, 10, img.naturalHeight - 20);

      // 서명 캔버스의 내용을 이미지에 그리기
      ctx.drawImage(signatureCanvas, img.naturalWidth - signatureCanvas.width - 20, img.naturalHeight - signatureCanvas.height - 20);

      // Blob으로 변환하여 다운로드
      canvas.toBlob(function (blob) {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'join_with_name_address_signature_and_checkboxes.png';
        link.click();
      }, 'image/png');
    });
  </script>
</body>

</html>